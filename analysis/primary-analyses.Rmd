---
title: "primary-analyses"
author: "rackerman27"
date: "2020-03-19"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction

## Loading Libraries

```{r}
library(glmmTMB)
library(TMB)
library(lattice)
library(lme4)
library(nlme)
library(DHARMa)
```

## Reading in data set

```{r}
library(haven)
SD_data4 <- read_sav("data/pairwise_SD_data.sav")
View(SD_data4)
```

## Functions for Later Use

# Rounding Function

```{r}
rround  = function (num,dig)    # Rounding function
{
  if (dig==2) return(sprintf("%.2f", round(num,2)))
  if (dig==3) return(sprintf("%.3f", round(num,3)))
  if (dig==1) return(sprintf("%.1f", round(num,1)))
  if (dig==4) return(sprintf("%.4f", round(num,4)))
  if (dig==5) return(sprintf("%.5f", round(num,5)))
}
```

# SRM Relative Percentage Function

```{r}
SRMRelativePercentage <- function(MActVar, FPartVar, MFRelVar, FActVar, MPartVar, FMRelVar) {
  MFActorPerc = 100*(MActVar/(MActVar + FPartVar + MFRelVar))
  MFPartPerc = 100*(FPartVar/(MActVar + FPartVar + MFRelVar))
  MFRelPerc = 100*(MFRelVar/(MActVar + FPartVar + MFRelVar))
  MFTotVar = (MActVar + FPartVar + MFRelVar)
  FMActorPerc = 100*(FActVar/(FActVar + MPartVar + FMRelVar))
  FMPartPerc = 100*(MPartVar/(FActVar + MPartVar + FMRelVar))
  FMRelPerc = 100*(FMRelVar/(FActVar + MPartVar + FMRelVar))
  FMTotVar = (FActVar + MPartVar + FMRelVar)
  list(MFActorPerc, MFPartPerc, MFRelPerc, MFTotVar, FMActorPerc, FMPartPerc, FMRelPerc, FMTotVar)
  
  {tab_BasicSRM <- as.data.frame(matrix(c(
    #Relative SRM Variance Percentages for Man-to-Woman Ratings
    rround(MFActorPerc, 2),
    rround(MFPartPerc, 2),
    rround(MFRelPerc, 2),
    rround(MFTotVar, 2),
    
    #Relative SRM Variance Percentages for Woman-to-Man Ratings
    rround(FMActorPerc, 2),
    rround(FMPartPerc, 2),
    rround(FMRelPerc, 2),
    rround(FMTotVar, 2))
    
    #Features of Table
    ,ncol=4, byrow=TRUE))
    rownames(tab_BasicSRM) <- c('Man-to-Woman Ratings', 
                                'Woman-to-Man Ratings')
    colnames(tab_BasicSRM) <- c('Actor', 'Partner', 'Relation Plus Error', 'Total Variance')
  }
  return(tab_BasicSRM)
}
```

### Basic SRM Analysis of Perceptions of Partner's Narcissism

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "APARTNARC", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_APARTNARC <- SD_data4[myvars]
SD_data_APARTNARC <- na.omit(SD_data_APARTNARC)
```

## Basic SRM Analysis

```{r}
basicSRM_APARTNARC <- glmmTMB(APARTNARC ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_APARTNARC,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_APARTNARC)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_APARTNARC)),
     freq = FALSE, ylim = c(0, 1), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Narcissism",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_APARTNARC))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_APARTNARC)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_APARTNARC)))
```

There are some minor problems with the normality of the residuals for APARTNARC, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_APARTNARC_simres <- simulateResiduals(basicSRM_APARTNARC)
system.time(sr.basicSRM_APARTNARC <- simulateResiduals(basicSRM_APARTNARC))
plot(sr.basicSRM_APARTNARC)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_APARTNARC
newdata$GROUPID = NA
pred_APARTNARC <- predict(basicSRM_APARTNARC, newdata)
Stdresiduals_APARTNARC <- scale(resid(basicSRM_APARTNARC))
```

```{r}
plot(pred_APARTNARC, Stdresiduals_APARTNARC)
```

No noticeable issues with non-linearity, though there may be some concern with heteroscedasticity given the smaller variability at lower levels of predicted narcissism compared to higher levels.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_APARTNARC <- ranef(basicSRM_APARTNARC)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, 1), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Narcissism",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, 1), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Narcissism",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects are rather non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, 1), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Narcissism",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, 1), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Narcissism",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem rather non-normal in shape (histogram is especially high in kurtosis).

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Narcissism",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Narcissism",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_APARTNARC$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_APARTNARC$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.908263, FPartVar = 0.057862, MFRelVar = 0.678044, 
                      FActVar = 0.755441, MPartVar = 0.016787, FMRelVar = 0.685712)
```


### Basic SRM Analysis of Perceptions of Partner's Warmth

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AWARM", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AWARM <- SD_data4[myvars]
SD_data_AWARM <- na.omit(SD_data_AWARM)
```

## Basic SRM Analysis

```{r}
basicSRM_AWARM <- glmmTMB(AWARM ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AWARM,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same exact deviance value and virtually identical parameter estimates.


```{r}
updated_basicSRM_AWARM <- update(basicSRM_AWARM, control=glmmTMBControl(optimizer=optim,
               optArgs=list(method="BFGS")))
```

```{r}
all.equal(ranef(basicSRM_AWARM), ranef(updated_basicSRM_AWARM))
```

Random effects are nearly identical.

```{r}
summary(basicSRM_AWARM)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AWARM)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Warmth",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AWARM))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AWARM)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AWARM)))
```

There are some minor problems with the normality of the residuals for AWARM, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AWARM_simres <- simulateResiduals(basicSRM_AWARM)
system.time(sr.basicSRM_AWARM <- simulateResiduals(basicSRM_AWARM))
plot(sr.basicSRM_AWARM)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AWARM
newdata$GROUPID = NA
pred_AWARM <- predict(basicSRM_AWARM, newdata)
Stdresiduals_AWARM <- scale(resid(basicSRM_AWARM))
```

```{r}
plot(pred_AWARM, Stdresiduals_AWARM)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AWARM <- ranef(basicSRM_AWARM)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Warmth",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Warmth",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Warmth",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Warmth",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Warmth",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Warmth",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AWARM$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AWARM$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AWARM$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.805500, FPartVar = 0.805482, MFRelVar = 1.599805, 
                      FActVar = 0.922503, MPartVar = 0.606151, FMRelVar = 2.336658)
```

### Basic SRM Analysis of Perceptions of Partner's Dominance

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ADOMINANT", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ADOMINANT <- SD_data4[myvars]
SD_data_ADOMINANT <- na.omit(SD_data_ADOMINANT)
```

## Basic SRM Analysis

```{r}
basicSRM_ADOMINANT <- glmmTMB(ADOMINANT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ADOMINANT,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same exact deviance value and virtually identical parameter estimates.

```{r}
updated_basicSRM_ADOMINANT <- update(basicSRM_ADOMINANT, control=glmmTMBControl(optimizer=optim,
               optArgs=list(method="BFGS")))
```

```{r}
all.equal(ranef(basicSRM_ADOMINANT), ranef(updated_basicSRM_ADOMINANT))
```

Random effects are nearly identical.

```{r}
summary(basicSRM_ADOMINANT)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ADOMINANT)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Dominance",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ADOMINANT))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ADOMINANT)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ADOMINANT)))
```

Residuals are pretty normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ADOMINANT_simres <- simulateResiduals(basicSRM_ADOMINANT)
system.time(sr.basicSRM_ADOMINANT <- simulateResiduals(basicSRM_ADOMINANT))
plot(sr.basicSRM_ADOMINANT)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ADOMINANT
newdata$GROUPID = NA
pred_ADOMINANT <- predict(basicSRM_ADOMINANT, newdata)
Stdresiduals_ADOMINANT <- scale(resid(basicSRM_ADOMINANT))
```

```{r}
plot(pred_ADOMINANT, Stdresiduals_ADOMINANT)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ADOMINANT <- ranef(basicSRM_ADOMINANT)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Dominance",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem somewhat non-normal in shape (histogram suggests high degree of kurtosis)

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Dominance",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Dominance",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Dominance",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape (although histogram suggests high level of kurtosis)

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Dominance",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Dominance",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ADOMINANT$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ADOMINANT$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.361737, FPartVar = 0.376160, MFRelVar = 2.724991, 
                      FActVar = 0.753043, MPartVar = 1.454595, FMRelVar = 2.461820)
```

### Basic SRM Analysis of Perceptions of Partner's Assured-Dominance

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AAssDom", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AAssDom <- SD_data4[myvars]
SD_data_AAssDom <- na.omit(SD_data_AAssDom)
```

## Basic SRM Analysis

```{r}
basicSRM_AAssDom <- glmmTMB(AAssDom ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AAssDom,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same exact deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AAssDom)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AAssDom)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Assured-Dominance",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AAssDom))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AAssDom)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AAssDom)))
```

Residuals appear to be normally distributed.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AAssDom_simres <- simulateResiduals(basicSRM_AAssDom)
system.time(sr.basicSRM_AAssDom <- simulateResiduals(basicSRM_AAssDom))
plot(sr.basicSRM_AAssDom)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AAssDom
newdata$GROUPID = NA
pred_AAssDom <- predict(basicSRM_AAssDom, newdata)
Stdresiduals_AAssDom <- scale(resid(basicSRM_AAssDom))
```

```{r}
plot(pred_AAssDom, Stdresiduals_AAssDom)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AAssDom <- ranef(basicSRM_AAssDom)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape (although histogram suggests high level of kurtosis).

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape (although histogram suggests high level of kurtosis).

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape (although histogram suggests some degree of kurtosis).

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AAssDom$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AAssDom$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.332879, FPartVar = 0.302594, MFRelVar = 0.829551, 
                      FActVar = 0.361586, MPartVar = 0.568426, FMRelVar = 0.920269)
```

### Basic SRM Analysis of Perceptions of Partner's Cold-Hearted

## Subsetting data

```{r}
SD_data4$AColdHrt <- as.numeric(SD_data4$AColdHrt)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AColdHrt", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AColdHrt <- SD_data4[myvars]
SD_data_AColdHrt <- na.omit(SD_data_AColdHrt)

```

## Basic SRM Analysis

```{r}
basicSRM_AColdHrt <- glmmTMB(AColdHrt ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF|GROUPID:MaleID) + (0 +   FM|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AColdHrt,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same exact deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AColdHrt)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AColdHrt)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Cold-Hearted",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AColdHrt))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AColdHrt)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AColdHrt)))
```

There are some minor problems with the normality of the residuals for AColdHrt, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AColdHrt_simres <- simulateResiduals(basicSRM_AColdHrt)
system.time(sr.basicSRM_AColdHrt <- simulateResiduals(basicSRM_AColdHrt))
plot(sr.basicSRM_AColdHrt)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AColdHrt
newdata$GROUPID = NA
pred_AColdHrt <- predict(basicSRM_AColdHrt, newdata)
Stdresiduals_AColdHrt <- scale(resid(basicSRM_AColdHrt))
```

```{r}
plot(pred_AColdHrt, Stdresiduals_AColdHrt)
```

No noticeable issues with non-linearity, though maybe concerns with heteroscedasticity given the smaller variance at lower levels of predicted cold-heartedness than higher levels.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AColdHrt <- ranef(basicSRM_AColdHrt)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Cold-Hearted",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AColdHrt$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Cold-Hearted",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AColdHrt$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Cold-Hearted",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Cold-Hearted",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AColdHrt$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.465325, FPartVar = 0, MFRelVar = 0.448190, 
                      FActVar = 0.279084, MPartVar = 0, FMRelVar = 0.587456)
```

### Basic SRM Analysis of Perceptions of Partner's Submissiveness

## Subsetting data

```{r}
SD_data4$ASubmit <- as.numeric(SD_data4$ASubmit)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ASubmit", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ASubmit <- SD_data4[myvars]
SD_data_ASubmit <- na.omit(SD_data_ASubmit)
```

## Basic SRM Analysis

```{r}
basicSRM_ASubmit <- glmmTMB(ASubmit ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ASubmit,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_ASubmit)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ASubmit)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Submissiveness",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ASubmit))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ASubmit)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ASubmit)))
```

Residuals appear normally distributed.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ASubmit_simres <- simulateResiduals(basicSRM_ASubmit)
system.time(sr.basicSRM_ASubmit <- simulateResiduals(basicSRM_ASubmit))
plot(sr.basicSRM_ASubmit)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ASubmit
newdata$GROUPID = NA
pred_ASubmit <- predict(basicSRM_ASubmit, newdata)
Stdresiduals_ASubmit <- scale(resid(basicSRM_ASubmit))
```

```{r}
plot(pred_ASubmit, Stdresiduals_ASubmit)
```

No noticeable issues with non-linearity, but maybe some concerns with heteroscedasticity given that variance seems smaller for predicted submissiveness ratings at lower levels than higher levels.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ASubmit <- ranef(basicSRM_ASubmit)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty non-normal in shape (histogram suggests high levels of kurtosis).

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem non-normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ASubmit$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ASubmit$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.340777, FPartVar = 0.453336, MFRelVar = 0.845340, 
                      FActVar = 0.300643, MPartVar = 0.492399, FMRelVar = 0.848326)
```

### Basic SRM Analysis of Perceptions of Partner's Arrogant-Calculating

## Subsetting data

```{r}
SD_data4$AArrCalc <- as.numeric(SD_data4$AArrCalc)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AArrCalc", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AArrCalc <- SD_data4[myvars]
SD_data_AArrCalc <- na.omit(SD_data_AArrCalc)
```

## Basic SRM Analysis

```{r}
basicSRM_AArrCalc <- glmmTMB(AArrCalc ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AArrCalc,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_AArrCalc)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AArrCalc)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Arrogant-Calculating",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AArrCalc))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AArrCalc)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AArrCalc)))
```

There are some minor problems with the normality of the residuals for AArrCalc.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AArrCalc_simres <- simulateResiduals(basicSRM_AArrCalc)
system.time(sr.basicSRM_AArrCalc <- simulateResiduals(basicSRM_AArrCalc))
plot(sr.basicSRM_AArrCalc)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AArrCalc
newdata$GROUPID = NA
pred_AArrCalc <- predict(basicSRM_AArrCalc, newdata)
Stdresiduals_AArrCalc <- scale(resid(basicSRM_AArrCalc))
```

```{r}
plot(pred_AArrCalc, Stdresiduals_AArrCalc)
```

No noticeable issues with non-linearity, but some concerns with heteroscedasticity given that variance seems smaller at lower levels of predicted Arrogant-Calculating than higher levels.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AArrCalc <- ranef(basicSRM_AArrCalc)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem rather non-normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty non-normal in shape (and histogram suggests high levels of kurtosis).

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape (though histogram suggests high levels of kurtosis).

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AArrCalc$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AArrCalc$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.486187, FPartVar = 0.048775, MFRelVar = 0.492956, 
                      FActVar = 0.555123, MPartVar = 0.072989, FMRelVar = 0.518301)
```

### Basic SRM Analysis of Perceptions of Partner's Warmth-Agreeableness

## Subsetting data

```{r}
SD_data4$AWarmAgree <- as.numeric(SD_data4$AWarmAgree)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AWarmAgree", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AWarmAgree <- SD_data4[myvars]
SD_data_AWarmAgree <- na.omit(SD_data_AWarmAgree)
```

## Basic SRM Analysis

```{r}
basicSRM_AWarmAgree <- glmmTMB(AWarmAgree ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AWarmAgree,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_AWarmAgree)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AWarmAgree)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Warmth-Agreeableness",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AWarmAgree))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AWarmAgree)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AWarmAgree)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AWarmAgree_simres <- simulateResiduals(basicSRM_AWarmAgree)
system.time(sr.basicSRM_AWarmAgree <- simulateResiduals(basicSRM_AWarmAgree))
plot(sr.basicSRM_AWarmAgree)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AWarmAgree
newdata$GROUPID = NA
pred_AWarmAgree <- predict(basicSRM_AWarmAgree, newdata)
Stdresiduals_AWarmAgree <- scale(resid(basicSRM_AWarmAgree))
```

```{r}
plot(pred_AWarmAgree, Stdresiduals_AWarmAgree)
```

No noticeable issues with non-linearity, but there may be some issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AWarmAgree <- ranef(basicSRM_AWarmAgree)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem rather non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AWarmAgree$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AWarmAgree$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.380198, FPartVar = 0.805482, MFRelVar = 0.393121, 
                      FActVar = 0.457677, MPartVar = 0.047922, FMRelVar = 0.876874)
```

### Basic SRM Analysis of Perceptions of Partner's Gregarious-Extraversion

## Subsetting data

```{r}
SD_data4$AGregExtra <- as.numeric(SD_data4$AGregExtra)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AGregExtra", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AGregExtra <- SD_data4[myvars]
SD_data_AGregExtra <- na.omit(SD_data_AGregExtra)
```

## Basic SRM Analysis

```{r}
basicSRM_AGregExtra <- glmmTMB(AGregExtra ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AGregExtra,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AGregExtra)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AGregExtra)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner's Gregarious-Extraversion",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AGregExtra))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AGregExtra)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AGregExtra)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AGregExtra_simres <- simulateResiduals(basicSRM_AGregExtra)
system.time(sr.basicSRM_AGregExtra <- simulateResiduals(basicSRM_AGregExtra))
plot(sr.basicSRM_AGregExtra)
```

In contrast to what was expected from the qq-plot and histogram, the Kolmogoriv-Smirnov test indicates that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AGregExtra
newdata$GROUPID = NA
pred_AGregExtra <- predict(basicSRM_AGregExtra, newdata)
Stdresiduals_AGregExtra <- scale(resid(basicSRM_AGregExtra))
```

```{r}
plot(pred_AGregExtra, Stdresiduals_AGregExtra)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AGregExtra <- ranef(basicSRM_AGregExtra)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape (although the histogram suggests high levels of kurtosis).

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem normal in shape (although the histogram suggests high levels of kurtosis).

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AGregExtra$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AGregExtra$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.184681, FPartVar = 0.309118, MFRelVar = 0.501298, 
                      FActVar = 0.200488, MPartVar = 0.458535, FMRelVar = 0.848005)
```

### Basic SRM Analysis of Ratings of Romantic Attraction
## Subsetting data

```{r}
SD_data4$AATTRACT <- as.numeric(SD_data4$AATTRACT)
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AATTRACT", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AATTRACT <- SD_data4[myvars]
SD_data_AATTRACT <- na.omit(SD_data_AATTRACT)
```

## Basic SRM Analysis

```{r}
basicSRM_AATTRACT <- glmmTMB(AATTRACT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AATTRACT,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AATTRACT)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AATTRACT)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Romantic Attraction",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AATTRACT))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AATTRACT)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AATTRACT)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AATTRACT_simres <- simulateResiduals(basicSRM_AATTRACT)
system.time(sr.basicSRM_AATTRACT <- simulateResiduals(basicSRM_AATTRACT))
plot(sr.basicSRM_AATTRACT)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AATTRACT
newdata$GROUPID = NA
pred_AATTRACT <- predict(basicSRM_AATTRACT, newdata)
Stdresiduals_AATTRACT <- scale(resid(basicSRM_AATTRACT))
```

```{r}
plot(pred_AATTRACT, Stdresiduals_AATTRACT)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AATTRACT <- ranef(basicSRM_AATTRACT)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Romantic Attraction",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Romantic Attraction",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Romantic Attraction",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Romantic Attraction",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Romantic Attraction",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Romantic Attraction",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AATTRACT$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AATTRACT$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.328676, FPartVar = 0.615468, MFRelVar = 0.704036, 
                      FActVar = 0.399978, MPartVar = 0.616203, FMRelVar = 0.897650)
```

### Basic SRM Analysis of Ratings of Connection to Partner

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ACONNECT", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ACONNECT <- SD_data4[myvars]
SD_data_ACONNECT <- na.omit(SD_data_ACONNECT)
```

## Basic SRM Analysis

```{r}
basicSRM_ACONNECT <- glmmTMB(ACONNECT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ACONNECT,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_ACONNECT)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ACONNECT)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Connection to Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ACONNECT))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ACONNECT)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ACONNECT)))
```

Residuals are normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ACONNECT_simres <- simulateResiduals(basicSRM_ACONNECT)
system.time(sr.basicSRM_ACONNECT <- simulateResiduals(basicSRM_ACONNECT))
plot(sr.basicSRM_ACONNECT)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ACONNECT
newdata$GROUPID = NA
pred_ACONNECT <- predict(basicSRM_ACONNECT, newdata)
Stdresiduals_ACONNECT <- scale(resid(basicSRM_ACONNECT))
```

```{r}
plot(pred_ACONNECT, Stdresiduals_ACONNECT)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ACONNECT <- ranef(basicSRM_ACONNECT)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Connection to Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Connection to Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Connection to Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Connection to Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Connection to Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Connection to Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ACONNECT$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ACONNECT$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.365082, FPartVar = 0.368869, MFRelVar = 0.666642, 
                      FActVar = 0.356916, MPartVar = 0.221728, FMRelVar = 1.014470)
```

### Basic SRM Analysis of Meta-Perceptions of Attraction

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AMETAATTRACT", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AMETAATTRACT <- SD_data4[myvars]
SD_data_AMETAATTRACT <- na.omit(SD_data_AMETAATTRACT)
```

## Basic SRM Analysis

```{r}
basicSRM_AMETAATTRACT <- glmmTMB(AMETAATTRACT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AMETAATTRACT,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AMETAATTRACT)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AMETAATTRACT)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Meta-Perceptions of Attraction",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AMETAATTRACT))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AMETAATTRACT)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AMETAATTRACT)))
```

There are some minor problems with the normality of the residuals for AMETAATTRACT, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AMETAATTRACT_simres <- simulateResiduals(basicSRM_AMETAATTRACT)
system.time(sr.basicSRM_AMETAATTRACT <- simulateResiduals(basicSRM_AMETAATTRACT))
plot(sr.basicSRM_AMETAATTRACT)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AMETAATTRACT
newdata$GROUPID = NA
pred_AMETAATTRACT <- predict(basicSRM_AMETAATTRACT, newdata)
Stdresiduals_AMETAATTRACT <- scale(resid(basicSRM_AMETAATTRACT))
```

```{r}
plot(pred_AMETAATTRACT, Stdresiduals_AMETAATTRACT)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AMETAATTRACT <- ranef(basicSRM_AMETAATTRACT)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AMETAATTRACT$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.645736, FPartVar = 0.097856, MFRelVar = 0.603775, 
                      FActVar = 1.007057, MPartVar = 0.139484, FMRelVar = 0.691160)
```

### Basic SRM Analysis of Self-Reports of Disclosure to Partner

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ADISCLOSURE", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ADISCLOSURE <- SD_data4[myvars]
SD_data_ADISCLOSURE <- na.omit(SD_data_ADISCLOSURE)
```

## Basic SRM Analysis

```{r}
basicSRM_ADISCLOSURE <- glmmTMB(ADISCLOSURE ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ADISCLOSURE,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_ADISCLOSURE)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ADISCLOSURE)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Self-Reports of Disclosure to Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ADISCLOSURE))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ADISCLOSURE)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ADISCLOSURE)))
```

There are some minor problems with the normality of the residuals for ADISCLOSURE, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ADISCLOSURE_simres <- simulateResiduals(basicSRM_ADISCLOSURE)
system.time(sr.basicSRM_ADISCLOSURE <- simulateResiduals(basicSRM_ADISCLOSURE))
plot(sr.basicSRM_ADISCLOSURE)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ADISCLOSURE
newdata$GROUPID = NA
pred_ADISCLOSURE <- predict(basicSRM_ADISCLOSURE, newdata)
Stdresiduals_ADISCLOSURE <- scale(resid(basicSRM_ADISCLOSURE))
```

```{r}
plot(pred_ADISCLOSURE, Stdresiduals_ADISCLOSURE)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ADISCLOSURE <- ranef(basicSRM_ADISCLOSURE)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem non-normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Self-Reports of Disclosure to Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ADISCLOSURE$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.893362, FPartVar = 0.097955, MFRelVar = 0.828585, 
                      FActVar = 1.027344, MPartVar = 0.161045, FMRelVar = 0.898061)
```

### Basic SRM Analysis of Informant-Reports of Disclosure to Partner

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AIR_Disclose", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AIR_Disclose <- SD_data4[myvars]
SD_data_AIR_Disclose <- na.omit(SD_data_AIR_Disclose)
```

## Basic SRM Analysis

```{r}
basicSRM_AIR_Disclose <- glmmTMB(AIR_Disclose ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AIR_Disclose,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_AIR_Disclose)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AIR_Disclose)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Informant-Reports of Disclosure to Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AIR_Disclose))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AIR_Disclose)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AIR_Disclose)))
```

There are some minor problems with the normality of the residuals for AIR_Disclose, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AIR_Disclose_simres <- simulateResiduals(basicSRM_AIR_Disclose)
system.time(sr.basicSRM_AIR_Disclose <- simulateResiduals(basicSRM_AIR_Disclose))
plot(sr.basicSRM_AIR_Disclose)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AIR_Disclose
newdata$GROUPID = NA
pred_AIR_Disclose <- predict(basicSRM_AIR_Disclose, newdata)
Stdresiduals_AIR_Disclose <- scale(resid(basicSRM_AIR_Disclose))
```

```{r}
plot(pred_AIR_Disclose, Stdresiduals_AIR_Disclose)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AIR_Disclose <- ranef(basicSRM_AIR_Disclose)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Informant-Reports of Disclosure to Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AIR_Disclose$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AIR_Disclose$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.764269, FPartVar = 0.083245, MFRelVar = 0.815617, 
                      FActVar = 0.704531, MPartVar = 0.101480, FMRelVar = 1.175084)
```

### Basic SRM Analysis of Ratings of Partner Desirability

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, ADESIRABLE) ~ ADESIRABLE,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ADESIRABLE\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ADESIRABLE", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ADESIRABLE <- SD_data4[myvars]
SD_data_ADESIRABLE <- na.omit(SD_data_ADESIRABLE)
```

## Basic SRM Analysis

```{r}
basicSRM_ADESIRABLE <- glmmTMB(ADESIRABLE ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ADESIRABLE,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_ADESIRABLE)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ADESIRABLE)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner Desirability",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ADESIRABLE))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ADESIRABLE)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ADESIRABLE)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ADESIRABLE_simres <- simulateResiduals(basicSRM_ADESIRABLE)
system.time(sr.basicSRM_ADESIRABLE <- simulateResiduals(basicSRM_ADESIRABLE))
plot(sr.basicSRM_ADESIRABLE)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ADESIRABLE
newdata$GROUPID = NA
pred_ADESIRABLE <- predict(basicSRM_ADESIRABLE, newdata)
Stdresiduals_ADESIRABLE <- scale(resid(basicSRM_ADESIRABLE))
```

```{r}
plot(pred_ADESIRABLE, Stdresiduals_ADESIRABLE)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ADESIRABLE <- ranef(basicSRM_ADESIRABLE)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Desirability",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Desirability",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Desirability",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Desirability",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Desirability",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Desirability",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ADESIRABLE$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ADESIRABLE$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.297157, FPartVar = 0.463355, MFRelVar = 0.447178, 
                      FActVar = 0.221423, MPartVar = 0.577188, FMRelVar = 0.691441)
```

### Basic SRM Analysis of Ratings of Perceived Responsiveness from Partner

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, APercResp) ~ APercResp,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'APercResp\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "APercResp", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_APercResp <- SD_data4[myvars]
SD_data_APercResp <- na.omit(SD_data_APercResp)
```

## Basic SRM Analysis

```{r}
basicSRM_APercResp <- glmmTMB(APercResp ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_APercResp,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_APercResp)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_APercResp)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Perceived Responsiveness from Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_APercResp))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_APercResp)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_APercResp)))
```

There are some minor problems with the normality of the residuals for APercResp.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_APercResp_simres <- simulateResiduals(basicSRM_APercResp)
system.time(sr.basicSRM_APercResp <- simulateResiduals(basicSRM_APercResp))
plot(sr.basicSRM_APercResp)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_APercResp
newdata$GROUPID = NA
pred_APercResp <- predict(basicSRM_APercResp, newdata)
Stdresiduals_APercResp <- scale(resid(basicSRM_APercResp))
```

```{r}
plot(pred_APercResp, Stdresiduals_APercResp)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_APercResp <- ranef(basicSRM_APercResp)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem a little non-normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Perceived Responsiveness from Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_APercResp$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_APercResp$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_APercResp$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.453620, FPartVar = 0.074056, MFRelVar = 0.617408, 
                      FActVar = 0.459010, MPartVar = 0.128050, FMRelVar = 0.788042)
```

### Basic SRM Analysis of Ratings of Perceived Admiration from Partner

## Visual Inspection of Variable Distributions Across Groups

```{r}
SD_data4$AADMIRE <- as.numeric(SD_data4$AADMIRE)
dotplot(
  reorder(GROUPID, AADMIRE) ~ AADMIRE,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AADMIRE\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AADMIRE", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AADMIRE <- SD_data4[myvars]
SD_data_AADMIRE <- na.omit(SD_data_AADMIRE)
```

## Basic SRM Analysis

```{r}
basicSRM_AADMIRE <- glmmTMB(AADMIRE ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AADMIRE,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_AADMIRE)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_AADMIRE)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Perceived Admiration from Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_AADMIRE))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_AADMIRE)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_AADMIRE)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_AADMIRE_simres <- simulateResiduals(basicSRM_AADMIRE)
system.time(sr.basicSRM_AADMIRE <- simulateResiduals(basicSRM_AADMIRE))
plot(sr.basicSRM_AADMIRE)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AADMIRE
newdata$GROUPID = NA
pred_AADMIRE <- predict(basicSRM_AADMIRE, newdata)
Stdresiduals_AADMIRE <- scale(resid(basicSRM_AADMIRE))
```

```{r}
plot(pred_AADMIRE, Stdresiduals_AADMIRE)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_AADMIRE <- ranef(basicSRM_AADMIRE)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Perceived Admiration from Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_AADMIRE$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_AADMIRE$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.630885, FPartVar = 0.099537, MFRelVar = 0.399118, 
                      FActVar = 0.627599, MPartVar = 0.069086, FMRelVar = 0.511605)
```

### Basic SRM Analysis of Ratings of Trust towards Partner

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, ATRUST) ~ ATRUST,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ATRUST\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ATRUST", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ATRUST <- SD_data4[myvars]
SD_data_ATRUST <- na.omit(SD_data_ATRUST)
```

## Basic SRM Analysis

```{r}
basicSRM_ATRUST <- glmmTMB(ATRUST ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM |GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ATRUST,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_ATRUST)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ATRUST)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Trust towards Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ATRUST))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ATRUST)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ATRUST)))
```

There are some problems with the normality of the residuals for ATRUST, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ATRUST_simres <- simulateResiduals(basicSRM_ATRUST)
system.time(sr.basicSRM_ATRUST <- simulateResiduals(basicSRM_ATRUST))
plot(sr.basicSRM_ATRUST)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ATRUST
newdata$GROUPID = NA
pred_ATRUST <- predict(basicSRM_ATRUST, newdata)
Stdresiduals_ATRUST <- scale(resid(basicSRM_ATRUST))
```

```{r}
plot(pred_ATRUST, Stdresiduals_ATRUST)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ATRUST <- ranef(basicSRM_ATRUST)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Trust towards Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Trust towards Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem a little non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ATRUST$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Trust towards Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ATRUST$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ATRUST$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ATRUST$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Trust towards Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Trust towards Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ATRUST$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.650744, FPartVar = 0, MFRelVar = 1.553520, 
                      FActVar = 1.095017, MPartVar = 0.245851, FMRelVar = 1.056469)
```

### Basic SRM Analysis of Ratings of Partner Caring

## Visual Inspection of Variable Distributions Across Groups

```{r}
SD_data4$ACARING <- as.numeric(SD_data4$ACARING)
dotplot(
  reorder(GROUPID, ACARING) ~ ACARING,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ACARING\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ACARING", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ACARING <- SD_data4[myvars]
SD_data_ACARING <- na.omit(SD_data_ACARING)
```

## Basic SRM Analysis

```{r}
basicSRM_ACARING <- glmmTMB(ACARING ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ACARING,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

```{r}
summary(basicSRM_ACARING)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ACARING)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Partner Caring",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ACARING))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ACARING)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ACARING)))
```

Residuals appear more-or-less normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ACARING_simres <- simulateResiduals(basicSRM_ACARING)
system.time(sr.basicSRM_ACARING <- simulateResiduals(basicSRM_ACARING))
plot(sr.basicSRM_ACARING)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ACARING
newdata$GROUPID = NA
pred_ACARING <- predict(basicSRM_ACARING, newdata)
Stdresiduals_ACARING <- scale(resid(basicSRM_ACARING))
```

```{r}
plot(pred_ACARING, Stdresiduals_ACARING)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ACARING <- ranef(basicSRM_ACARING)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Caring",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Caring",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem a little non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Caring",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Caring",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Caring",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Caring",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ACARING$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ACARING$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ACARING$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.334760, FPartVar = 0.103867, MFRelVar = 0.369085, 
                      FActVar = 0.401503, MPartVar = 0.094458, FMRelVar = 0.786045)
```

### Basic SRM Analysis of Ratings of Sexual Chemistry

## Visual Inspection of Variable Distributions Across Groups

```{r}
SD_data4$ASEXCHEM <- as.numeric(SD_data4$ASEXCHEM)
dotplot(
  reorder(GROUPID, ASEXCHEM) ~ ASEXCHEM,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ASEXCHEM\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ASEXCHEM", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ASEXCHEM <- SD_data4[myvars]
SD_data_ASEXCHEM <- na.omit(SD_data_ASEXCHEM)
```

## Basic SRM Analysis

```{r}
basicSRM_ASEXCHEM <- glmmTMB(ASEXCHEM ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + (0 + MF + FM|GROUPID:MaleID) + (0 + FM +
                              MF|GROUPID:FemaleID) + us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ASEXCHEM,
                              family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                              verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(basicSRM_ASEXCHEM)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(basicSRM_ASEXCHEM)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Basic SRM Analysis of Ratings of Sexual Chemistry",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(basicSRM_ASEXCHEM))))
box()
```

```{r}
qqnorm(scale(resid(basicSRM_ASEXCHEM)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(basicSRM_ASEXCHEM)))
```

There are some problems with the normality of the residuals for ASEXCHEM, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
basicSRM_ASEXCHEM_simres <- simulateResiduals(basicSRM_ASEXCHEM)
system.time(sr.basicSRM_ASEXCHEM <- simulateResiduals(basicSRM_ASEXCHEM))
plot(sr.basicSRM_ASEXCHEM)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ASEXCHEM
newdata$GROUPID = NA
pred_ASEXCHEM <- predict(basicSRM_ASEXCHEM, newdata)
Stdresiduals_ASEXCHEM <- scale(resid(basicSRM_ASEXCHEM))
```

```{r}
plot(pred_ASEXCHEM, Stdresiduals_ASEXCHEM)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_basicSRM_ASEXCHEM <- ranef(basicSRM_ASEXCHEM)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Sexual Chemistry",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_basicSRM_ASEXCHEM$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_basicSRM_ASEXCHEM$cond$`GROUPID:MaleID:FemaleID`)
```


## Getting Relative Percentage (these estimates are from SPSS)

```{r}
SRMRelativePercentage(MActVar = 0.540433, FPartVar = 0.510720, MFRelVar = 1.024732, 
                      FActVar = 0.400072, MPartVar = 0.200630, FMRelVar = 0.902894)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Narcissism

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, APARTNARC) ~ APARTNARC,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'APARTNARC\' for Speed-Dating Groups")
```

```{r}
SD_data4$Ac_NSM_Grandiosity <- as.numeric(SD_data4$Ac_NSM_Grandiosity)
SD_data4$Pc_NSM_Grandiosity <- as.numeric(SD_data4$Pc_NSM_Grandiosity)
dotplot(
  reorder(GROUPID, Ac_NSM_Grandiosity) ~ Ac_NSM_Grandiosity,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'Ac_NSM_Grandiosity\' for Speed-Dating Groups")
```
```{r}
SD_data4$Ac_NSM_Entitlement <- as.numeric(SD_data4$Ac_NSM_Entitlement)
SD_data4$Pc_NSM_Entitlement <- as.numeric(SD_data4$Pc_NSM_Entitlement)
dotplot(
  reorder(GROUPID, Ac_NSM_Entitlement) ~ Ac_NSM_Entitlement,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'Ac_NSM_Entitlement\' for Speed-Dating Groups")
```

```{r}
SD_data4$Ac_NSM_Vulnerability <- as.numeric(SD_data4$Ac_NSM_Vulnerability)
SD_data4$Pc_NSM_Vulnerability <- as.numeric(SD_data4$Pc_NSM_Vulnerability)
dotplot(
  reorder(GROUPID, Ac_NSM_Vulnerability) ~ Ac_NSM_Vulnerability,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'Ac_NSM_Vulnerability\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "APARTNARC", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_APARTNARC.withNSMTraits <- SD_data4[myvars]
SD_data_APARTNARC.withNSMTraits <- na.omit(SD_data_APARTNARC.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Narcissism

Note that because of the small partner effect variances, I had to fix them to 0 to get model to run.

```{r}
SRM_APARTNARC.withNSMTraits <- glmmTMB(APARTNARC ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       diag(0 + MF + FM |GROUPID:MaleID) + diag(0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_APARTNARC.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

```{r}
summary(SRM_APARTNARC.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_APARTNARC.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Narcissism",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_APARTNARC.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_APARTNARC.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_APARTNARC.withNSMTraits)))
```

There are some problems with the normality of the residuals for APARTNARC, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_APARTNARC.withNSMTraits_simres <- simulateResiduals(SRM_APARTNARC.withNSMTraits)
system.time(sr.SRM_APARTNARC.withNSMTraits <- simulateResiduals(SRM_APARTNARC.withNSMTraits))
plot(sr.SRM_APARTNARC.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_APARTNARC.withNSMTraits
newdata$GROUPID = NA
pred_APARTNARC.withNSMTraits <- predict(SRM_APARTNARC.withNSMTraits, newdata)
Stdresiduals_APARTNARC.withNSMTraits <- scale(resid(SRM_APARTNARC.withNSMTraits))
```

```{r}
plot(pred_APARTNARC.withNSMTraits, Stdresiduals_APARTNARC.withNSMTraits)
```

No noticeable issues with non-linearity, but potential issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_APARTNARC.withNSMTraits <- ranef(SRM_APARTNARC.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Narcissism",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Narcissism",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Narcissism",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Narcissism",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_APARTNARC.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AWARM) ~ AWARM,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AWARM\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AWARM", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AWARM.withNSMTraits <- SD_data4[myvars]
SD_data_AWARM.withNSMTraits <- na.omit(SD_data_AWARM.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth

```{r}
SRM_AWARM.withNSMTraits <- glmmTMB(AWARM ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AWARM.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AWARM.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AWARM.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AWARM.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AWARM.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AWARM.withNSMTraits)))
```

There are some minor problems with the normality of the residuals for AWARM, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AWARM.withNSMTraits_simres <- simulateResiduals(SRM_AWARM.withNSMTraits)
system.time(sr.SRM_AWARM.withNSMTraits <- simulateResiduals(SRM_AWARM.withNSMTraits))
plot(sr.SRM_AWARM.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AWARM.withNSMTraits
newdata$GROUPID = NA
pred_AWARM.withNSMTraits <- predict(SRM_AWARM.withNSMTraits, newdata)
Stdresiduals_AWARM.withNSMTraits <- scale(resid(SRM_AWARM.withNSMTraits))
```

```{r}
plot(pred_AWARM.withNSMTraits, Stdresiduals_AWARM.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AWARM.withNSMTraits <- ranef(SRM_AWARM.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Warmth",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Warmth",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Warmth",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Warmth",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Warmth",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests a little non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Warmth",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AWARM.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Dominance

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, ADOMINANT) ~ ADOMINANT,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ADOMINANT\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ADOMINANT", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ADOMINANT.withNSMTraits <- SD_data4[myvars]
SD_data_ADOMINANT.withNSMTraits <- na.omit(SD_data_ADOMINANT.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Dominance

```{r}
SRM_ADOMINANT.withNSMTraits <- glmmTMB(ADOMINANT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ADOMINANT.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

```{r}
summary(SRM_ADOMINANT.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_ADOMINANT.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Dominance",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_ADOMINANT.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_ADOMINANT.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_ADOMINANT.withNSMTraits)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_ADOMINANT.withNSMTraits_simres <- simulateResiduals(SRM_ADOMINANT.withNSMTraits)
system.time(sr.SRM_ADOMINANT.withNSMTraits <- simulateResiduals(SRM_ADOMINANT.withNSMTraits))
plot(sr.SRM_ADOMINANT.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ADOMINANT.withNSMTraits
newdata$GROUPID = NA
pred_ADOMINANT.withNSMTraits <- predict(SRM_ADOMINANT.withNSMTraits, newdata)
Stdresiduals_ADOMINANT.withNSMTraits <- scale(resid(SRM_ADOMINANT.withNSMTraits))
```

```{r}
plot(pred_ADOMINANT.withNSMTraits, Stdresiduals_ADOMINANT.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_ADOMINANT.withNSMTraits <- ranef(SRM_ADOMINANT.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Dominance",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Dominance",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Dominance",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Dominance",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Dominance",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Dominance",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some minor non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_ADOMINANT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Assured-Dominance

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AAssDom) ~ AAssDom,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AAssDom\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AAssDom", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AAssDom.withNSMTraits <- SD_data4[myvars]
SD_data_AAssDom.withNSMTraits <- na.omit(SD_data_AAssDom.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Assured-Dominance

```{r}
SRM_AAssDom.withNSMTraits <- glmmTMB(AAssDom ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AAssDom.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AAssDom.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AAssDom.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Assured-Dominance",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AAssDom.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AAssDom.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AAssDom.withNSMTraits)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AAssDom.withNSMTraits_simres <- simulateResiduals(SRM_AAssDom.withNSMTraits)
system.time(sr.SRM_AAssDom.withNSMTraits <- simulateResiduals(SRM_AAssDom.withNSMTraits))
plot(sr.SRM_AAssDom.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AAssDom.withNSMTraits
newdata$GROUPID = NA
pred_AAssDom.withNSMTraits <- predict(SRM_AAssDom.withNSMTraits, newdata)
Stdresiduals_AAssDom.withNSMTraits <- scale(resid(SRM_AAssDom.withNSMTraits))
```

```{r}
plot(pred_AAssDom.withNSMTraits, Stdresiduals_AAssDom.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AAssDom.withNSMTraits <- ranef(SRM_AAssDom.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem a little non-normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Assured-Dominance",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AAssDom.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Cold-Heartedness

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AColdHrt) ~ AColdHrt,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AColdHrt\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AColdHrt", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AColdHrt.withNSMTraits <- SD_data4[myvars]
SD_data_AColdHrt.withNSMTraits <- na.omit(SD_data_AColdHrt.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Cold-Heartedness

```{r}
SRM_AColdHrt.withNSMTraits <- glmmTMB(AColdHrt ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF |GROUPID:MaleID) + (0 + FM |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AColdHrt.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AColdHrt.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AColdHrt.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Cold-Heartedness",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AColdHrt.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AColdHrt.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AColdHrt.withNSMTraits)))
```

There are some minor problems with the normality of the residuals for AColdHrt.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AColdHrt.withNSMTraits_simres <- simulateResiduals(SRM_AColdHrt.withNSMTraits)
system.time(sr.SRM_AColdHrt.withNSMTraits <- simulateResiduals(SRM_AColdHrt.withNSMTraits))
plot(sr.SRM_AColdHrt.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AColdHrt.withNSMTraits
newdata$GROUPID = NA
pred_AColdHrt.withNSMTraits <- predict(SRM_AColdHrt.withNSMTraits, newdata)
Stdresiduals_AColdHrt.withNSMTraits <- scale(resid(SRM_AColdHrt.withNSMTraits))
```

```{r}
plot(pred_AColdHrt.withNSMTraits, Stdresiduals_AColdHrt.withNSMTraits)
```

No noticeable issues with non-linearity, but potential issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AColdHrt.withNSMTraits <- ranef(SRM_AColdHrt.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Cold-Heartedness",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Cold-Heartedness",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Cold-Heartedness",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Cold-Heartedness",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AColdHrt.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Submissiveness

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, ASubmit) ~ ASubmit,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'ASubmit\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "ASubmit", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_ASubmit.withNSMTraits <- SD_data4[myvars]
SD_data_ASubmit.withNSMTraits <- na.omit(SD_data_ASubmit.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Submissiveness

```{r}
SRM_ASubmit.withNSMTraits <- glmmTMB(ASubmit ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_ASubmit.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_ASubmit.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_ASubmit.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Submissiveness",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_ASubmit.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_ASubmit.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_ASubmit.withNSMTraits)))
```

Residuals are normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_ASubmit.withNSMTraits_simres <- simulateResiduals(SRM_ASubmit.withNSMTraits)
system.time(sr.SRM_ASubmit.withNSMTraits <- simulateResiduals(SRM_ASubmit.withNSMTraits))
plot(sr.SRM_ASubmit.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_ASubmit.withNSMTraits
newdata$GROUPID = NA
pred_ASubmit.withNSMTraits <- predict(SRM_ASubmit.withNSMTraits, newdata)
Stdresiduals_ASubmit.withNSMTraits <- scale(resid(SRM_ASubmit.withNSMTraits))
```

```{r}
plot(pred_ASubmit.withNSMTraits, Stdresiduals_ASubmit.withNSMTraits)
```

No noticeable issues with non-linearity, but potential issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_ASubmit.withNSMTraits <- ranef(SRM_ASubmit.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Submissiveness",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_ASubmit.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Arrogant-Calculating

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AArrCalc) ~ AArrCalc,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AArrCalc\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AArrCalc", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AArrCalc.withNSMTraits <- SD_data4[myvars]
SD_data_AArrCalc.withNSMTraits <- na.omit(SD_data_AArrCalc.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Arrogant-Calculating

```{r}
SRM_AArrCalc.withNSMTraits <- glmmTMB(AArrCalc ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AArrCalc.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

```{r}
summary(SRM_AArrCalc.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AArrCalc.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Arrogant-Calculating",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AArrCalc.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AArrCalc.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AArrCalc.withNSMTraits)))
```

There are some minor problems with the normality of the residuals for AArrCalc.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AArrCalc.withNSMTraits_simres <- simulateResiduals(SRM_AArrCalc.withNSMTraits)
system.time(sr.SRM_AArrCalc.withNSMTraits <- simulateResiduals(SRM_AArrCalc.withNSMTraits))
plot(sr.SRM_AArrCalc.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AArrCalc.withNSMTraits
newdata$GROUPID = NA
pred_AArrCalc.withNSMTraits <- predict(SRM_AArrCalc.withNSMTraits, newdata)
Stdresiduals_AArrCalc.withNSMTraits <- scale(resid(SRM_AArrCalc.withNSMTraits))
```

```{r}
plot(pred_AArrCalc.withNSMTraits, Stdresiduals_AArrCalc.withNSMTraits)
```

No noticeable issues with non-linearity, but potential issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AArrCalc.withNSMTraits <- ranef(SRM_AArrCalc.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty non-normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty non-normal in shape (histogram suggests really high levels of kurtosis).

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Arrogant-Calculating",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AArrCalc.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth-Agreeableness

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AWarmAgree) ~ AWarmAgree,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AWarmAgree\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AWarmAgree", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AWarmAgree.withNSMTraits <- SD_data4[myvars]
SD_data_AWarmAgree.withNSMTraits <- na.omit(SD_data_AWarmAgree.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth-Agreeableness

```{r}
SRM_AWarmAgree.withNSMTraits <- glmmTMB(AWarmAgree ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AWarmAgree.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AWarmAgree.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AWarmAgree.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Warmth-Agreeableness",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AWarmAgree.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AWarmAgree.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AWarmAgree.withNSMTraits)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AWarmAgree.withNSMTraits_simres <- simulateResiduals(SRM_AWarmAgree.withNSMTraits)
system.time(sr.SRM_AWarmAgree.withNSMTraits <- simulateResiduals(SRM_AWarmAgree.withNSMTraits))
plot(sr.SRM_AWarmAgree.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AWarmAgree.withNSMTraits
newdata$GROUPID = NA
pred_AWarmAgree.withNSMTraits <- predict(SRM_AWarmAgree.withNSMTraits, newdata)
Stdresiduals_AWarmAgree.withNSMTraits <- scale(resid(SRM_AWarmAgree.withNSMTraits))
```

```{r}
plot(pred_AWarmAgree.withNSMTraits, Stdresiduals_AWarmAgree.withNSMTraits)
```

No noticeable issues with non-linearity, but potential issues with heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AWarmAgree.withNSMTraits <- ranef(SRM_AWarmAgree.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Warmth-Agreeableness",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AWarmAgree.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Partner Gregarious-Extraversion

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AGregExtra) ~ AGregExtra,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AGregExtra\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AGregExtra", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AGregExtra.withNSMTraits <- SD_data4[myvars]
SD_data_AGregExtra.withNSMTraits <- na.omit(SD_data_AGregExtra.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Partner Gregarious-Extraversion

```{r}
SRM_AGregExtra.withNSMTraits <- glmmTMB(AGregExtra ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AGregExtra.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AGregExtra.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AGregExtra.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Partner Gregarious-Extraversion",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AGregExtra.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AGregExtra.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AGregExtra.withNSMTraits)))
```

There are some minor problems with the normality of the residuals for AGregExtra.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AGregExtra.withNSMTraits_simres <- simulateResiduals(SRM_AGregExtra.withNSMTraits)
system.time(sr.SRM_AGregExtra.withNSMTraits <- simulateResiduals(SRM_AGregExtra.withNSMTraits))
plot(sr.SRM_AGregExtra.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AGregExtra.withNSMTraits
newdata$GROUPID = NA
pred_AGregExtra.withNSMTraits <- predict(SRM_AGregExtra.withNSMTraits, newdata)
Stdresiduals_AGregExtra.withNSMTraits <- scale(resid(SRM_AGregExtra.withNSMTraits))
```

```{r}
plot(pred_AGregExtra.withNSMTraits, Stdresiduals_AGregExtra.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AGregExtra.withNSMTraits <- ranef(SRM_AGregExtra.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Partner Gregarious-Extraversion",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests some non-normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AGregExtra.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Ratings of Attraction to Partner
## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AATTRACT) ~ AATTRACT,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AATTRACT\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AATTRACT", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AATTRACT.withNSMTraits <- SD_data4[myvars]
SD_data_AATTRACT.withNSMTraits <- na.omit(SD_data_AATTRACT.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Ratings of Attraction to Partner

```{r}
SRM_AATTRACT.withNSMTraits <- glmmTMB(AATTRACT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AATTRACT.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

glmmTMB issues a false convergence warning (8), but same model runs fine in SPSS, with the same deviance value and virtually identical parameter estimates.

```{r}
summary(SRM_AATTRACT.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AATTRACT.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Ratings of Attraction to Partner",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AATTRACT.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AATTRACT.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AATTRACT.withNSMTraits)))
```

Residuals appear normal in shape.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AATTRACT.withNSMTraits_simres <- simulateResiduals(SRM_AATTRACT.withNSMTraits)
system.time(sr.SRM_AATTRACT.withNSMTraits <- simulateResiduals(SRM_AATTRACT.withNSMTraits))
plot(sr.SRM_AATTRACT.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AATTRACT.withNSMTraits
newdata$GROUPID = NA
pred_AATTRACT.withNSMTraits <- predict(SRM_AATTRACT.withNSMTraits, newdata)
Stdresiduals_AATTRACT.withNSMTraits <- scale(resid(SRM_AATTRACT.withNSMTraits))
```

```{r}
plot(pred_AATTRACT.withNSMTraits, Stdresiduals_AATTRACT.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AATTRACT.withNSMTraits <- ranef(SRM_AATTRACT.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Ratings of Attraction to Partner",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Ratings of Attraction to Partner",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Ratings of Attraction to Partner",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem more-or-less normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Ratings of Attraction to Partner",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Ratings of Attraction to Partner",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Ratings of Attraction to Partner",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```

### Narcissistic Traits Predicting SRM Effects for Meta-Perceptions of Attraction

## Visual Inspection of Variable Distributions Across Groups

```{r}
dotplot(
  reorder(GROUPID, AMETAATTRACT) ~ AMETAATTRACT,
  data = SD_data4, jitter.y = TRUE,
  ylab = "Speed-Dating Group",
  main = "Dotplot of \'AMETAATTRACT\' for Speed-Dating Groups")
```

## Subsetting data

```{r}
myvars <- c("GROUPID", "MaleID", "FemaleID", "MF", "FM",
            "AMETAATTRACT", "Ac_NSM_Grandiosity", "Ac_NSM_Entitlement",
	    "Ac_NSM_Vulnerability", "Pc_NSM_Grandiosity", "Pc_NSM_Entitlement",
	    "Pc_NSM_Vulnerability", "Agender", "GroupID_EC1", "GroupID_EC2",
            "GroupID_EC3", "GroupID_EC4", "GroupID_EC5", "GroupID_EC6",
            "GroupID_EC7", "GroupID_EC8", "GroupID_EC9", "GroupID_EC10",
            "GroupID_EC11", "GroupID_EC12", "GroupID_EC13", "GroupID_EC14",
            "GroupID_EC15", "GroupID_EC16", "GroupID_EC17", "GroupID_EC18",
            "GroupID_EC19", "GroupID_EC20", "GroupID_EC21", "GroupID_EC22",
            "GroupID_EC23", "GroupID_EC24", "GroupID_EC25", "GroupID_EC26",
            "GroupID_EC27", "GroupID_EC28", "GroupID_EC29", "GroupID_EC30",
            "GroupID_EC31", "GroupID_EC32")

SD_data_AMETAATTRACT.withNSMTraits <- SD_data4[myvars]
SD_data_AMETAATTRACT.withNSMTraits <- na.omit(SD_data_AMETAATTRACT.withNSMTraits)
```

## Narcissistic Traits Predicting SRM Effects for Meta-Perceptions of Attraction

```{r}
SRM_AMETAATTRACT.withNSMTraits <- glmmTMB(AMETAATTRACT ~ 1 + Agender*GroupID_EC1 + Agender*GroupID_EC2 + Agender*GroupID_EC3 + Agender*GroupID_EC4 +
                              Agender*GroupID_EC5 + Agender*GroupID_EC6 + Agender*GroupID_EC7 + Agender*GroupID_EC8 + Agender*GroupID_EC9 +
                              Agender*GroupID_EC10 + Agender*GroupID_EC11 + Agender*GroupID_EC12 + Agender*GroupID_EC13 + Agender*GroupID_EC14 +
                              Agender*GroupID_EC15 + Agender*GroupID_EC16 + Agender*GroupID_EC17 + Agender*GroupID_EC18 + Agender*GroupID_EC19 +
                              Agender*GroupID_EC20 + Agender*GroupID_EC21 + Agender*GroupID_EC22 + Agender*GroupID_EC23 + Agender*GroupID_EC24 +
                              Agender*GroupID_EC25 + Agender*GroupID_EC26 + Agender*GroupID_EC27 + Agender*GroupID_EC28 + Agender*GroupID_EC29 +
                              Agender*GroupID_EC30 + Agender*GroupID_EC31 + Agender*GroupID_EC32 + Agender*Ac_NSM_Grandiosity +
			      Agender*Ac_NSM_Entitlement + Agender*Ac_NSM_Vulnerability + Agender*Pc_NSM_Grandiosity +
			      Agender*Pc_NSM_Entitlement + Agender*Pc_NSM_Vulnerability +
                                       (0 + MF + FM |GROUPID:MaleID) + (0 + FM + MF |GROUPID:FemaleID) + 
                                       us(0 + MF + FM + 0| GROUPID:MaleID:FemaleID),data = SD_data_AMETAATTRACT.withNSMTraits,
                                       family = gaussian(link = "identity"), dispformula=~0, REML = TRUE, 
                                       verbose = FALSE, na.action = na.omit)
```

```{r}
summary(SRM_AMETAATTRACT.withNSMTraits)
```

## Checking Normality of Level-1 Residuals

# Standard low tech way

```{r}
hist(scale(resid(SRM_AMETAATTRACT.withNSMTraits)),
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     main = "Narcissistic Traits Predicting SRM Effects for Meta-Perceptions of Attraction",
     col = "lightblue",
     xlab = "Standardized Residuals")
lines(density(scale(resid(SRM_AMETAATTRACT.withNSMTraits))))
box()
```

```{r}
qqnorm(scale(resid(SRM_AMETAATTRACT.withNSMTraits)), main = "Normal Quantile-Quantile Plot")
qqline(scale(resid(SRM_AMETAATTRACT.withNSMTraits)))
```

There are some problems with the normality of the residuals for AMETAATTRACT, most likely due to the fact that it is a single-item measure.

# More high tech way with DHARMa package (note that residual ~ pred plot is incorrect)

```{r}
SRM_AMETAATTRACT.withNSMTraits_simres <- simulateResiduals(SRM_AMETAATTRACT.withNSMTraits)
system.time(sr.SRM_AMETAATTRACT.withNSMTraits <- simulateResiduals(SRM_AMETAATTRACT.withNSMTraits))
plot(sr.SRM_AMETAATTRACT.withNSMTraits)
```

The Kolmogoriv-Smirnov test confirms that the assumption of normality of the residuals is NOT violated.

## Checking for potential non-linearity and heteroscedasticity

# Method suggested by Florian Hartig on Github to obtain predicted values
# that are not conditioned on random effects (this prevents an artificial
# correlation between residuals and predicted values in scatterplot)

```{r}
newdata=SD_data_AMETAATTRACT.withNSMTraits
newdata$GROUPID = NA
pred_AMETAATTRACT.withNSMTraits <- predict(SRM_AMETAATTRACT.withNSMTraits, newdata)
Stdresiduals_AMETAATTRACT.withNSMTraits <- scale(resid(SRM_AMETAATTRACT.withNSMTraits))
```

```{r}
plot(pred_AMETAATTRACT.withNSMTraits, Stdresiduals_AMETAATTRACT.withNSMTraits)
```

No noticeable issues with non-linearity or heteroscedasticity.

## Checking Normality of Random Effects

# Extracting Random Effects from Model

```{r}
REs_SRM_AMETAATTRACT.withNSMTraits <- ranef(SRM_AMETAATTRACT.withNSMTraits)
```

# Histogram and Q-Q Plot for Male Actor Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Actor Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Men's Actor Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$MF))
```

The random effects for men's actor effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Male Partner Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Men's Partner Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Men's Partner Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`$FM))
```

The random effects for men's partner effects seem pretty normal in shape.

# Histogram and Q-Q Plot for Female Actor Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Actor Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Women's Actor Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$FM))
```

The random effects for women's actor effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Female Partner Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Women's Partner Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Women's Partner Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`$MF))
```

The random effects for women's partner effects seem somewhat non-normal in shape.

# Histogram and Q-Q Plot for Man-to-Woman Relationship Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Man-to-Woman Relationship Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Man-to-Woman Relationship Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$MF))
```

Q-Q plot suggests some non-normality.

# Histogram and Q-Q Plot for Woman-to-Man Relationship Effects

```{r}
hist(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM, col = "lightblue",
     freq = FALSE, ylim = c(0, .7), xlim = c(-4, 5),
     xlab = "Woman-to-Man Relationship Effects for Meta-Perceptions of Attraction",
     main = "Histogram for Woman-to-Man Relationship Effects")
lines(density(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
box()
```

```{r}
qqnorm(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM), main = "Normal Quantile-Quantile Plot")
qqline(scale(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`$FM))
```

Q-Q plot suggests normality.

# Scatterplots for Pairs of Random Effects

# Scatterplot of men's actor and partner effects

```{r}
plot(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID`)
```

# Scatterplot of women's actor and partner effects

```{r}
plot(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:FemaleID`)
```

# Scatterplot of men's and women's relationship effects

```{r}
plot(REs_SRM_AMETAATTRACT.withNSMTraits$cond$`GROUPID:MaleID:FemaleID`)
```


